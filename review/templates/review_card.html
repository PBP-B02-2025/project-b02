
{% load static %}
<article id="review-{{ review.id }}" class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm mb-4">
    <!-- Header with username and rating -->
    <div class="flex items-center justify-between mb-3">
        <div class="flex items-center space-x-3">
            <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                <span class="text-white font-semibold text-sm">{{ review.user.username|first|upper }}</span>
            </div>
            <div>
                <p class="font-medium text-gray-900">{{ review.user.username }}</p>
                <div class="flex items-center space-x-1">
                    {% for i in "12345" %}
                        {% if forloop.counter <= review.star %}
                            <svg class="w-4 h-4 text-yellow-400 fill-current" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                        {% else %}
                            <svg class="w-4 h-4 text-gray-300 fill-current" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                        {% endif %}
                    {% endfor %}
                    <span class="text-sm text-gray-500 ml-1">({{ review.star }}/5)</span>
                </div>
            </div>
        </div>
        
        <!-- Actions for review owner -->
        {% if user.is_authenticated and review.user == user %}
        <div class="flex space-x-2">
            <button onclick="editReview('{{ review.id }}')" class="text-blue-600 hover:text-blue-800 text-sm">
                Edit
            </button>
            <button onclick="deleteReview('{{ review.id }}')" class="text-red-600 hover:text-red-800 text-sm">
                Delete
            </button>
        </div>
        {% endif %}
    </div>

    <!-- Comment -->
    <div class="text-gray-700">
        <p>{{ review.comment|linebreaksbr }}</p>
    </div>

    <!-- Remove date display since created_at field doesn't exist -->
</article>

<script>
function deleteReview(reviewId) {
    if (confirm('Are you sure you want to delete this review?')) {
        fetch(`/review/review/${reviewId}/delete`, {
            method: 'DELETE',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            if (data.success) {
                // Hapus review dari DOM
                const reviewElement = document.getElementById(`review-${reviewId}`);
                if (reviewElement) {
                    reviewElement.style.transition = 'opacity 0.3s ease';
                    reviewElement.style.opacity = '0';
                    setTimeout(() => reviewElement.remove(), 300);
                }
                console.log("Deleted:", data.message);
            } else {
                alert(data.message || "Failed to delete review");
            }
        })
        .catch(err => {
            console.error("Error:", err);
        });
    }
}


function editReview(reviewId) {
    // For now, redirect to edit page or implement inline editing
    window.location.href = `/review/review/${reviewId}/edit`;
}
</script>